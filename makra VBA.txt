Sub Ustaw_filtry()
    
    Dim stataNazwa As String
    
    staraNazwa = ActiveSheet.Name
    ActiveSheet.Name = "AllTscmScanResults"
    Sheets("AllTscmScanResults").Activate
    Range("AT1").Select
    ActiveCell.FormulaR1C1 = "Assigned team"
    Rows("1:1").Select
    With Selection.Font
        .ThemeColor = xlThemeColorDark1
        .TintAndShade = 0
    End With
    With Selection.Interior
        .Pattern = xlSolid
        .PatternColorIndex = xlAutomatic
        .ThemeColor = xlThemeColorLight1
        .TintAndShade = 0
        .PatternTintAndShade = 0
    End With
    If Not ActiveSheet.AutoFilterMode Then
        ActiveSheet.Rows("1:1").AutoFilter
    End If
    Columns("Z:AG").Select
    Selection.EntireColumn.Hidden = True
    Range("B2").Select
    Application.CutCopyMode = False
    Rows("1:1").Select
    With ActiveWindow
        .SplitColumn = 0
        .SplitRow = 1
    End With
    ActiveWindow.FreezePanes = True
    Range("A1").Select
    Sheets.Add
    On Error Resume Next
    ActiveSheet.Name = "PivotTable"
    If Err.Number = 1004 Then
        Dim i As Variant
        i = Now
        Dim ss As String
        On Error GoTo 0
        Sheets("PivotTable").Name = "PivotTable, " + Replace(Str(Now), ":", "-")
        ActiveSheet.Name = "PivotTable"
    End If
    On Error GoTo 0
    Sheets("AllTscmScanResults").Activate
    ActiveWorkbook.PivotCaches.Create(SourceType:=xlDatabase, SourceData:= _
        "AllTscmScanResults!R1C1:R1048576C44", Version:=6).CreatePivotTable _
        TableDestination:="PivotTable!R3C1", TableName:="Tabela przestawna1", _
        DefaultVersion:=6
    Sheets("PivotTable").Select
    Cells(3, 1).Select
    With ActiveSheet.PivotTables("Tabela przestawna1")
        .ColumnGrand = True
        .HasAutoFormat = True
        .DisplayErrorString = False
        .DisplayNullString = True
        .EnableDrilldown = True
        .ErrorString = ""
        .MergeLabels = False
        .NullString = ""
        .PageFieldOrder = 2
        .PageFieldWrapCount = 0
        .PreserveFormatting = True
        .RowGrand = True
        .SaveData = True
        .PrintTitles = False
        .RepeatItemsOnEachPrintedPage = True
        .TotalsAnnotation = False
        .CompactRowIndent = 1
        .InGridDropZones = False
        .DisplayFieldCaptions = True
        .DisplayMemberPropertyTooltips = False
        .DisplayContextTooltips = True
        .ShowDrillIndicators = True
        .PrintDrillIndicators = False
        .AllowMultipleFilters = False
        .SortUsingCustomLists = True
        .FieldListSortAscending = False
        .ShowValuesRow = False
        .CalculatedMembersInFilters = False
        .RowAxisLayout xlCompactRow
    End With
    With ActiveSheet.PivotTables("Tabela przestawna1").PivotCache
        .RefreshOnFileOpen = False
        .MissingItemsLimit = xlMissingItemsDefault
    End With
    ActiveSheet.PivotTables("Tabela przestawna1").RepeatAllLabels xlRepeatLabels
    With ActiveSheet.PivotTables("Tabela przestawna1").PivotFields("Client")
        .Orientation = xlRowField
        .Position = 1
    End With
    With ActiveSheet.PivotTables("Tabela przestawna1").PivotFields("Product")
        .Orientation = xlRowField
        .Position = 2
    End With
    With ActiveSheet.PivotTables("Tabela przestawna1").PivotFields("Policy name")
        .Orientation = xlRowField
        .Position = 3
    End With
    With ActiveSheet.PivotTables("Tabela przestawna1").PivotFields("Test name")
        .Orientation = xlRowField
        .Position = 4
    End With
    With ActiveSheet.PivotTables("Tabela przestawna1").PivotFields("Test state")
        .Orientation = xlPageField
        .Position = 1
    End With
    ActiveSheet.PivotTables("Tabela przestawna1").AddDataField ActiveSheet. _
        PivotTables("Tabela przestawna1").PivotFields("Test name"), _
        "Liczba z Test name", xlCount
    ActiveSheet.PivotTables("Tabela przestawna1").PivotFields("Client"). _
        ShowDetail = False
    Range("B4").Select
    Range(Selection, Selection.End(xlDown)).Select
    ActiveSheet.PivotTables("Tabela przestawna1").PivotFields("Client"). _
        AutoSort xlDescending, "Liczba z Test name", ActiveSheet.PivotTables( _
        "Tabela przestawna1").PivotColumnAxis.PivotLines(1), 1
    Sheets("AllTscmScanResults").Name = staraNazwa
    
End Sub

Sub UsunDecom()

    Dim adres, kolumna, rzad As Variant

    Dim fileName As String
    Dim miesiac As String
    Dim dzien As String
    
    Dim AllTSCM As Workbook
    Dim AllCIs As Workbook
     
    Sheets("AllTscmScanResults").Select
    Range("AY1").Select
    ActiveCell.FormulaR1C1 = "bez 2-."
    Selection.Offset(1, 0).Select
    ActiveCell.FormulaR1C1 = _
        "=IFERROR(LEFT(RC5,FIND("":"",RC5)-1),RC5)"
    kolumna = ActiveCell.Column
    Call skopiuj(kolumna)

    Set AllTSCM = ActiveWorkbook
    miesiac = Month(Date)
    dzien = Day(Date)
    If miesiac < 10 Then
        miesiac = "0" & miesiac
    End If
    If dzien < 10 Then
        dzien = "0" & dzien
    End If
   ' fileName = Environ("USERPROFILE") & "\Downloads\" & "AllCIs_" & Year(Date) & "." & miesiac & "." & dzien & ".xlsx"
    fileName = "\\ispnas2.ad.ing.net\userdata\" & Environ("USERNAME") & "\Downloads\" & "AllCIs_" & Year(Date) & "." & miesiac & "." & dzien & ".xlsx"
    Workbooks.Open fileName:=fileName
    Set AllCIs = ActiveWorkbook
    AllTSCM.Activate
    Range("BA1").Formula = "uniqueciname"
    Range("BB1").Formula = "environment"
    Range("BC1").Formula = "createdby"
    Range("BD1").Formula = "status"
    Range("BA2").Select
    kolumna = ActiveCell.Column
    adres = ActiveCell.Address
    fileName = "=[AllCIs_" & Year(Date) & "." & miesiac & "." & dzien & ".xlsx]CIs!RC[-50]"     'idz do C2
    ActiveCell.FormulaR1C1 = fileName
    Selection.Offset(0, 1).Select
    ActiveCell.FormulaR1C1 = fileName
    Selection.Offset(0, 1).Select
    ActiveCell.FormulaR1C1 = fileName
    Selection.Offset(0, 1).Select
    ActiveCell.FormulaR1C1 = fileName
    Range(adres).Resize(, 4).Select
    Call skopiuj(kolumna)
    Selection.End(xlDown).Select
    rzad = ActiveCell.Row
    Set AllCIs = ActiveWorkbook
    Rows("1:1").Select
    Selection.AutoFilter
    Selection.AutoFilter
    ActiveSheet.Range("$A$1:$AI$531036").AutoFilter Field:=56, Criteria1:= _
        "DECOMMISSIONED"
    Range("AX2").Select
    zmienna = "=VLOOKUP(RC[1],R2C[3]:R" & rzad & "C[6],4,FALSE)"
    ActiveCell.FormulaR1C1 = zmienna
    zmienna = "AX2:AX" & rzad
    Selection.AutoFill Destination:=Range(zmienna)
End Sub

Public Sub skopiuj(kolumna As Variant)
    
    Selection.Copy
    Range("A1").Select
    Selection.End(xlDown).Select
    Selection.Offset(0, kolumna - 1).Select 'bo A ma index 1
    Range(Selection, Selection.End(xlUp)).Select
    ActiveSheet.Paste
End Sub






'DO SKASOWANIA

Sub obróbka_przecinków()


    Columns("B:B").Select
    With Selection.Interior
        .PatternColorIndex = xlAutomatic
        .Color = 65535
        .TintAndShade = 0
        .PatternTintAndShade = 0
    End With
    Columns("J:J").Select
    With Selection.Interior
        .PatternColorIndex = xlAutomatic
        .Color = 65535
        .TintAndShade = 0
        .PatternTintAndShade = 0
    End With
    Columns("X:X").Select
    With Selection.Interior
        .PatternColorIndex = xlAutomatic
        .Color = 65535
        .TintAndShade = 0
        .PatternTintAndShade = 0
    End With
    Rows("1:1").Select
    With Selection.Interior
        .Pattern = xlSolid
        .PatternColorIndex = xlAutomatic
        .ThemeColor = xlThemeColorLight1
        .TintAndShade = 0
        .PatternTintAndShade = 0
    End With
    With Selection.Font
        .ThemeColor = xlThemeColorDark1
        .TintAndShade = 0
    End With
    Selection.AutoFilter
    Columns("K:W").Select
    Range("W1").Activate
    Selection.EntireColumn.Hidden = True
    Columns("J:J").Select
    Columns("J:J").EntireColumn.AutoFit
    Columns("X:X").ColumnWidth = 101.14
    Range("A1").Select
    ActiveWindow.SmallScroll Down:=-12
End Sub

Sub mailto()

'    Dim Recipient As String
'    Recipient = Worksheets("Form").Range("B14").Value
'   Application.Dialogs(xlDialogSendMail).Show Recipient

End Sub
